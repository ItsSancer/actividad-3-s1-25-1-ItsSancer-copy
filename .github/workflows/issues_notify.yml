name: Discussions → Telegram topic decorated

on:
  discussion:
    types: [created]
  discussion_comment:
    types: [created]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Notificar nueva discusión
        if: github.event_name == 'discussion' && github.event.action == 'created'
        run: |
          MESSAGE=$(printf "🚨 Nueva Pregunta Abierta 🚨\n\n📁 Repositorio: %s\n\n📝 Título: %s\n\n👤 Autor: %s\n\n🗒️ Descripción:\n%s\n\nEnlace: %s" \
            "${{ github.repository }}" \
            "${{ github.event.discussion.title }}" \
            "${{ github.event.discussion.user.login }}" \
            "${{ github.event.discussion.body }}" \
            "${{ github.event.discussion.html_url }}")

          curl -s -X POST "https://api.telegram.org/bot${{ secrets.BOT_TOKEN }}/sendMessage" \
            -d chat_id=${{ secrets.CHAT_ID }} \
            -d message_thread_id=2 \
            --data-urlencode text="$MESSAGE"

      - name: Notify new issue comment
        if: github.event_name == 'discussion_comment' && github.event.action == 'created'
        run: |
          MESSAGE=$(printf "🚨 Nuevo comentario en Discusión 🚨\n\n📝 Discusión: %s\n\n👤 Comentado por: %s\n\n✏️ Comentario:\n%s\n\n🔗 Enlace: %s" \
            "${{ github.event.discussion.title }}" \
            "${{ github.event.comment.user.login }}" \
            "${{ github.event.comment.body }}" \
            "${{ github.event.comment.html_url }}")

          curl -s -X POST "https://api.telegram.org/bot${{ secrets.BOT_TOKEN }}/sendMessage" \
            -d chat_id=${{ secrets.CHAT_ID }} \
            -d message_thread_id=2 \
            --data-urlencode text="$MESSAGE"


