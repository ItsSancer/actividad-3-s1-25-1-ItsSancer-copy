name: Issues â†’ Telegram topic decorated

on:
  issues:
    types: [opened]
  issue_comment:
    types: [created]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Notificar nueva issue
        if: github.event_name == 'issues' && github.event.action == 'opened'
        run: |
          MESSAGE=$(printf "ğŸš¨ Nueva Issue Abierta ğŸš¨\n\n" \
            "ğŸ“ Repositorio: %s\n" \
            "ğŸ“ TÃ­tulo: %s\n" \
            "ğŸ‘¤ Autor: %s\n\n" \
            "ğŸ—’ï¸ DescripciÃ³n:\n%s\n\n" \
            "ğŸ”— Enlace: %s" \
            "${{ github.repository }}" \
            "${{ github.event.issue.title }}" \
            "${{ github.event.issue.user.login }}" \
            "${{ github.event.issue.body }}" \
            "${{ github.event.issue.html_url }}")

          curl -s -X POST "https://api.telegram.org/bot${{ secrets.BOT_TOKEN }}/sendMessage" \
            -d chat_id=${{ secrets.CHAT_ID }} \
            -d message_thread_id=2 \
            --data-urlencode parse_mode="MarkdownV2" \
            --data-urlencode text="$MESSAGE"

      - name: Notificar nuevo comentario en issue
        if: github.event_name == 'issue_comment' && github.event.action == 'created'
        run: |
          MESSAGE=$(printf "ğŸ’¬ *Nuevo Comentario en Issue* ğŸ’¬\n\n" \
            "ğŸ“ Issue: %s\n" \
            "ğŸ‘¤ Comentado por: %s\n\n" \
            "âœï¸ Comentario:\n%s\n\n" \
            "ğŸ”— Enlace: %s" \
            "${{ github.event.issue.title }}" \
            "${{ github.event.comment.user.login }}" \
            "${{ github.event.comment.body }}" \
            "${{ github.event.comment.html_url }}")

          curl -s -X POST "https://api.telegram.org/bot${{ secrets.BOT_TOKEN }}/sendMessage" \
            -d chat_id=${{ secrets.CHAT_ID }} \
            -d message_thread_id=2 \
            --data-urlencode parse_mode="MarkdownV2" \
            --data-urlencode text="$MESSAGE"
